<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<link rel="shortcut icon" type="image/png" href="https://icons.iconarchive.com/icons/custom-icon-design/pretty-office-10/64/Pencil-icon.png"/>

<header>
    <title>Ritomani </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<style>
    /* static/style.css */

.card li {
    font-size: 3vh;
}

.green {
    background-color: rgb(23, 189, 23);
}

.yellow {
    background-color: rgb(248, 233, 28);
}

.red {
    background-color: rgb(202, 13, 13);
}

.orange {
    background-color: #ffa600;
}



select option[value="green"] {
    background-color:#0F0
};

select option[value="yellow"] {
    background-color:#FF0
}

select option[value="orange"] {
    background-color:#ffa600
}

select option[value="red"] {
    background-color:#F00
}


.footer {
    padding-bottom: 1em;
    position: fixed;
   left: 0;
   bottom: 0;
   width: 100%;
}

.card li {
    height: 11vh;
}
</style>


</header>





<body >
    <div class="w3-container" id="card-container">
    </div>
</body>

<footer class="footer w3-black">
    <div class="w3-center w3-black">
        <h2>Ny Omgång:</h3>
        <div id="level_buttons"></div>
    </div>
</footer>


<script type="text/javascript">
    function get_param(urlParams, key, default_value) {
        var value = urlParams.get(key);
        return value !== null? value : default_value
    }

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);

    var turn = get_param(urlParams, 'turn', 0);
    var level = get_param(urlParams, 'level', 'green');

    var next_turn = 1 + parseInt(turn);
    var seed  = get_param(urlParams, 'seed', Math.round(Math.random() * 100000));

    document.getElementById("level_buttons").innerHTML =
    '<a class="w3-button w3-green" href="https://jacobgumpert.github.io/ritomani/draw?seed=' +  seed + '&turn=' + next_turn + '&level=green">GRÖNT</a>' +
    '<a class="w3-button w3-yellow" href="https://jacobgumpert.github.io/ritomani/draw?seed=' + seed + '&turn=' + next_turn + '&level=yellow">GULT</a>' +
    '<a class="w3-button w3-orange" href="https://jacobgumpert.github.io/ritomani/draw?seed=' + seed + '&turn=' + next_turn + '&level=orange">ORANGE</a>' +
    '<a class="w3-button w3-red" href="https://jacobgumpert.github.io/ritomani/draw?seed=' +    seed + '&turn=' + next_turn + '&level=red">RÖTT</a>';


    function mulberry32(a) {
        return function() {
        var t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
    }


    function add_card(title, index, entry){
        var card_container = $('#card-container');

        var start = index * 7;
        var end = start + 7;
        var card_list = '';
        for (i = start; i < end; i++) {
            card_list += '<li>' + entry[i].content.$t.toUpperCase() + '</li>'
        }

        var card = $('<div class="w3-card-4 w3-container w3-third card w3-' + level + '">' +
            '<h2 class="w3-center">' +  title + '</h2>' +
            '<ol class="w3-ol" id="ol-C">' +
            card_list +
            '</ol>' +
        '</div>')
        card_container.append(card)
    }




    var page = {
        "green": 1,
        "yellow": 2,
        "orange": 3,
        "red": 4
    };
    var url = 'https://spreadsheets.google.com/feeds/cells/1ifIDkf4Mk3RTII5DG-QV5eI2xWva94lfCyLHAM-fSXg/' + page[level] + '/public/full?alt=json';

    var data = $.getJSON(url, function(data) {
        var nbrCards = data.feed.entry.length/7;
        var resolved_seed = seed + Math.floor( turn / nbrCards / 3);
        var rand = mulberry32(resolved_seed);

        var deck = Array.from(Array(nbrCards).keys())

        // shuffle the cards
        for (let i = deck.length - 1; i > 0; i--) {
            let j = Math.floor(rand() * i);
            let temp = deck[i];
            deck[i] = deck[j];
            deck[j] = temp;
        }

        for (let i = 0; i < (turn*3 % nbrCards); i ++) {
            deck.pop()
        }

        add_card("A", deck.pop(), data.feed.entry)
        add_card("B", deck.pop(), data.feed.entry)
        add_card("C", deck.pop(), data.feed.entry)




        console.log(data);
    })
 </script>
</html>
